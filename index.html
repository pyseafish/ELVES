<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ELVES - ä¸šä½™æ— çº¿ç”µé€šè”æ—¥å¿—</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4A6FA5;
            --secondary-color: #6B8CBC;
            --background-color: #F5F7FA;
            --card-color: #FFFFFF;
            --text-color: #2D3748;
            --text-light: #718096;
            --border-color: #E2E8F0;
            --accent-color: #4299E1;
            --success-color: #48BB78;
            --warning-color: #ED8936;
            --danger-color: #F56565;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.05), 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        [data-theme="dark"] {
            --primary-color: #5A7BB5;
            --secondary-color: #7B9CCC;
            --background-color: #1a202c;
            --card-color: #2D3748;
            --text-color: #E2E8F0;
            --text-light: #A0AEC0;
            --border-color: #4A5568;
            --accent-color: #63B3ED;
            --success-color: #68D391;
            --warning-color: #F6AD55;
            --danger-color: #FC8181;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.2), 0 1px 3px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.2), 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            padding-bottom: 80px;
            font-weight: 400;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 0 16px;
        }

        /* é¡¶éƒ¨æ æ ·å¼ */
        .header {
            background-color: var(--primary-color);
            color: white;
            padding: 16px 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .header-callsign {
            font-size: 1.2rem;
            font-weight: 600;
            text-align: center;
            flex: 1;
        }

        .header-time {
            font-size: 1rem;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            text-align: right;
        }

        /* å†…å®¹åŒºåŸŸæ ·å¼ */
        .content {
            padding: 20px 0;
            min-height: calc(100vh - 140px);
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* è®°å½•å¡ç‰‡æ ·å¼ */
        .records-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
            padding: 0 8px; /* æ·»åŠ å·¦å³å†…è¾¹è· */
        }

        .record-card {
            background-color: var(--card-color);
            border-radius: 12px;
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid var(--border-color);
            width: 100%;
        }

        .record-card.collapsed {
            max-height: 120px;
        }

        .record-card.expanded {
            max-height: 1000px;
        }

        .record-summary {
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
            text-align: center;
        }

        .record-callsign {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .record-datetime {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .record-frequency {
            font-size: 0.95rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .contest-badge {
            background-color: var(--accent-color);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .record-details {
            padding: 0 16px 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            border-top: 1px solid var(--border-color);
            margin-top: 12px;
            padding-top: 16px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .detail-label {
            font-weight: 500;
            color: var(--text-color);
            opacity: 0.8;
            font-size: 0.9rem;
        }

        .detail-value {
            text-align: right;
            font-size: 0.95rem;
        }

        .record-actions {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 16px;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-color);
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn:active {
            transform: translateY(0);
        }

        /* è¡¨å•æ ·å¼ */
        .form-container {
            background-color: var(--card-color);
            padding: 24px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            width: 100%;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--card-color);
            color: var(--text-color);
            font-size: 1rem;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.2);
        }

        .form-row {
            display: flex;
            gap: 16px;
        }

        .form-row .form-group {
            flex: 1;
        }

        /* è®¾ç½®é¡µé¢æ ·å¼ */
        .settings-container {
            background-color: var(--card-color);
            padding: 24px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            width: 100%;
        }

        .settings-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .settings-section:last-child {
            border-bottom: none;
        }

        .settings-title {
            font-size: 1.2rem;
            margin-bottom: 16px;
            color: var(--primary-color);
            font-weight: 600;
        }

        .theme-toggle {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .theme-option {
            padding: 10px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            background-color: var(--card-color);
            color: var(--text-color);
            text-align: center;
            flex: 1;
        }

        .theme-option.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* åº•éƒ¨å¯¼èˆªæ ·å¼ */
        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--card-color);
            border-top: 1px solid var(--border-color);
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.05);
            z-index: 100;
            padding: 8px 0;
        }

        .nav-tabs {
            display: flex;
            justify-content: space-around;
        }

        .nav-tab {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
            flex: 1;
            max-width: 25%;
        }

        .nav-tab.active {
            background-color: rgba(74, 111, 165, 0.1);
            color: var(--primary-color);
        }

        .nav-icon {
            font-size: 1.4rem;
            margin-bottom: 4px;
        }

        .nav-label {
            font-size: 0.75rem;
            font-weight: 500;
        }

        /* ç­›é€‰åŒºåŸŸ */
        .filter-container {
            background-color: var(--card-color);
            padding: 16px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .filter-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .filter-content {
            margin-top: 16px;
            display: none;
        }

        .filter-content.expanded {
            display: block;
        }

        .filter-row {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 140px;
        }

        /* å¯¼å…¥å¯¼å‡ºåŒºåŸŸ */
        .import-export-section {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            justify-content: center;
        }

        .file-input {
            display: none;
        }

        .file-label {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 16px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem;
        }

        /* å…³äºä¿¡æ¯ */
        .about-info {
            text-align: center;
            padding: 24px;
            background-color: var(--card-color);
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-top: 20px;
        }

        .about-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--primary-color);
        }

        .about-text {
            color: var(--text-light);
            line-height: 1.8;
        }

        /* ç©ºçŠ¶æ€æç¤º */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }

        .empty-icon {
            font-size: 3rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-text {
            font-size: 1.1rem;
            margin-bottom: 8px;
        }

        .empty-subtext {
            font-size: 0.9rem;
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--card-color);
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            width: 90%;
            max-width: 400px;
            padding: 24px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-color);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
        }

        .modal-body {
            margin-bottom: 24px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* è¯­è¨€é€‰æ‹©å™¨ */
        .language-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }

        .language-option {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            background-color: var(--card-color);
            color: var(--text-color);
            font-size: 0.9rem;
        }

        .language-option.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* ç«èµ›é€‰æ‹©å™¨ */
        .contest-selector {
            margin-bottom: 20px;
        }

        /* è‡ªå®šä¹‰ä¸‹æ‹‰é€‰æ‹©æ ·å¼ */
        .custom-select {
            position: relative;
            width: 100%;
        }

        .custom-select-header {
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--card-color);
            color: var(--text-color);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .custom-select-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: var(--card-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            z-index: 10;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }

        .custom-select-options.active {
            display: block;
        }

        .custom-select-option {
            padding: 12px;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
        }

        .custom-select-option:last-child {
            border-bottom: none;
        }

        .custom-select-option:hover {
            background-color: rgba(74, 111, 165, 0.1);
        }

        /* è‡ªå®šä¹‰æ—¥æœŸæ—¶é—´é€‰æ‹©å™¨ */
        .datetime-picker {
            display: flex;
            gap: 12px;
        }

        .datetime-input {
            flex: 1;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--card-color);
            color: var(--text-color);
            cursor: pointer;
            text-align: center;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .import-export-section {
                flex-direction: column;
            }
            
            .filter-row {
                flex-direction: column;
            }
            
            .filter-group {
                min-width: 100%;
            }
            
            .header-title, .header-callsign, .header-time {
                font-size: 0.9rem;
            }
            
            .nav-label {
                font-size: 0.7rem;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0 12px;
            }
            
            .form-container, .settings-container {
                padding: 16px;
            }
            
            .record-actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨æ  -->
    <div class="header">
        <div class="container header-content">
            <div class="header-title">ELVES</div>
            <div class="header-callsign" id="userCallsign">æœªè®¾ç½®å‘¼å·</div>
            <div class="header-time" id="currentTime">--:--:--</div>
        </div>
    </div>

    <!-- å†…å®¹åŒºåŸŸ -->
    <div class="container content">
        <!-- è®°å½•é¡µé¢ -->
        <div class="page active" id="recordsPage">
            <h2 style="text-align: center; margin-bottom: 20px;" data-translate="records">é€šè”è®°å½•</h2>
            
            <!-- ç­›é€‰åŒºåŸŸ -->
            <div class="filter-container">
                <div class="filter-header" id="filterToggle">
                    <div class="filter-title" data-translate="filterConditions">ç­›é€‰æ¡ä»¶</div>
                    <div>â–¼</div>
                </div>
                <div class="filter-content" id="filterContent">
                    <div class="filter-row">
                        <div class="filter-group">
                            <label class="form-label" for="filterDateFrom" data-translate="startDate">å¼€å§‹æ—¥æœŸ</label>
                            <input type="date" id="filterDateFrom" class="form-control">
                        </div>
                        <div class="filter-group">
                            <label class="form-label" for="filterDateTo" data-translate="endDate">ç»“æŸæ—¥æœŸ</label>
                            <input type="date" id="filterDateTo" class="form-control">
                        </div>
                    </div>
                    <div class="filter-row">
                        <div class="filter-group">
                            <label class="form-label" for="filterCallsign" data-translate="callsign">å‘¼å·</label>
                            <input type="text" id="filterCallsign" class="form-control" placeholder="è¾“å…¥å‘¼å·">
                        </div>
                        <div class="filter-group">
                            <label class="form-label" for="filterGrid" data-translate="grid">ç½‘æ ¼åæ ‡</label>
                            <input type="text" id="filterGrid" class="form-control" placeholder="è¾“å…¥ç½‘æ ¼åæ ‡">
                        </div>
                    </div>
                    <div class="filter-row">
                        <div class="filter-group">
                            <label class="form-label" for="filterContest" data-translate="contest">æ¯”èµ›</label>
                            <div class="custom-select" id="filterContestSelect">
                                <div class="custom-select-header">
                                    <span id="filterContestValue" data-translate="all">å…¨éƒ¨</span>
                                    <span>â–¼</span>
                                </div>
                                <div class="custom-select-options" id="filterContestOptions">
                                    <div class="custom-select-option" data-value="">å…¨éƒ¨</div>
                                    <div class="custom-select-option" data-value="CQWPX">CQ WPX</div>
                                    <div class="custom-select-option" data-value="CQWW">CQWW</div>
                                    <div class="custom-select-option" data-value="WAPC">WAPC</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="filter-row">
                        <button class="btn btn-primary" id="applyFilterBtn" data-translate="applyFilter">åº”ç”¨ç­›é€‰</button>
                        <button class="btn btn-outline" id="clearFilterBtn" data-translate="clearFilter">æ¸…é™¤ç­›é€‰</button>
                    </div>
                </div>
            </div>
            
            <div class="records-container" id="recordsContainer">
                <!-- è®°å½•å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- æ–°å¢é¡µé¢ -->
        <div class="page" id="addPage">
            <h2 style="text-align: center; margin-bottom: 20px;" data-translate="addRecord">æ–°å¢é€šè”è®°å½•</h2>
            <div class="form-container">
                <div class="contest-selector">
                    <label class="form-label" data-translate="contestSelection">æ¯”èµ›é€‰æ‹©</label>
                    <div class="custom-select" id="contestSelect">
                        <div class="custom-select-header">
                            <span id="contestValue" data-translate="noContest">æ— æ¯”èµ›</span>
                            <span>â–¼</span>
                        </div>
                        <div class="custom-select-options" id="contestOptions">
                            <div class="custom-select-option" data-value="">æ— æ¯”èµ›</div>
                            <div class="custom-select-option" data-value="CQWPX">CQ WPX</div>
                            <div class="custom-select-option" data-value="CQWW">CQWW</div>
                            <div class="custom-select-option" data-value="WAPC">WAPC</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="callsign" data-translate="theirCallsign">å¯¹æ–¹å‘¼å·</label>
                    <input type="text" id="callsign" class="form-control" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="frequency" data-translate="frequency">é¢‘ç‡ (MHz)</label>
                        <input type="text" id="frequency" class="form-control" placeholder="14.195">
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-translate="mode">æ¨¡å¼</label>
                        <div class="custom-select" id="modeSelect">
                            <div class="custom-select-header">
                                <span id="modeValue">SSB</span>
                                <span>â–¼</span>
                            </div>
                            <div class="custom-select-options" id="modeOptions">
                                <div class="custom-select-option" data-value="SSB">SSB</div>
                                <div class="custom-select-option" data-value="CW">CW</div>
                                <div class="custom-select-option" data-value="FT8">FT8</div>
                                <div class="custom-select-option" data-value="FM">FM</div>
                                <div class="custom-select-option" data-value="AM">AM</div>
                                <div class="custom-select-option" data-value="å…¶ä»–">å…¶ä»–</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" data-translate="date">æ—¥æœŸ</label>
                        <input type="date" id="date" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-translate="time">æ—¶é—´</label>
                        <input type="time" id="time" class="form-control">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="rstSent" data-translate="sentReport">å‘é€ä¿¡å·æŠ¥å‘Š</label>
                        <input type="text" id="rstSent" class="form-control" placeholder="59">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="rstRcvd" data-translate="receivedReport">æ¥æ”¶ä¿¡å·æŠ¥å‘Š</label>
                        <input type="text" id="rstRcvd" class="form-control" placeholder="59">
                    </div>
                </div>
                
                <!-- æ¯”èµ›ç‰¹å®šå­—æ®µ -->
                <div id="contestFields" style="display: none;">
                    <div class="form-group" id="serialField" style="display: none;">
                        <label class="form-label" for="serial" data-translate="serialNumber">åºåˆ—å·</label>
                        <input type="text" id="serial" class="form-control" placeholder="001">
                    </div>
                    <div class="form-group" id="cqzoneField" style="display: none;">
                        <label class="form-label" for="cqzone" data-translate="cqZone">CQåˆ†åŒº</label>
                        <input type="text" id="cqzone" class="form-control" placeholder="24">
                    </div>
                    <div class="form-group" id="qsosNumberField" style="display: none;">
                        <label class="form-label" for="qsosNumber" data-translate="qsoNumber">QSOåºå·</label>
                        <input type="text" id="qsosNumber" class="form-control" placeholder="001">
                    </div>
                    <div class="form-group" id="provinceField" style="display: none;">
                        <label class="form-label" for="province" data-translate="provinceAbbr">çœå¸‚åŒºç¼©å†™</label>
                        <input type="text" id="province" class="form-control" placeholder="ZJ">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="name" data-translate="theirName">å¯¹æ–¹å§“å</label>
                    <input type="text" id="name" class="form-control">
                </div>
                <div class="form-group">
                    <label class="form-label" for="qth" data-translate="theirLocation">å¯¹æ–¹ä½ç½®</label>
                    <input type="text" id="qth" class="form-control">
                </div>
                <div class="form-group">
                    <label class="form-label" for="gridsquare" data-translate="theirGrid">å¯¹æ–¹ç½‘æ ¼åæ ‡</label>
                    <input type="text" id="gridsquare" class="form-control">
                </div>
                <div class="form-group">
                    <label class="form-label" for="comment" data-translate="remarks">å¤‡æ³¨</label>
                    <textarea id="comment" class="form-control" rows="3"></textarea>
                </div>
                
                <div class="import-export-section">
                    <input type="file" id="importFile" class="file-input" accept=".adi,.log,.txt">
                    <label for="importFile" class="file-label">ğŸ“ <span data-translate="importLog">å¯¼å…¥æ—¥å¿—</span></label>
                </div>
                
                <div class="form-group" style="margin-top: 20px;">
                    <button class="btn btn-primary" id="saveRecordBtn" style="width: 100%;" data-translate="saveRecord">ä¿å­˜è®°å½•</button>
                </div>
            </div>
        </div>

        <!-- è®¾ç½®é¡µé¢ -->
        <div class="page" id="settingsPage">
            <h2 style="text-align: center; margin-bottom: 20px;" data-translate="settings">è®¾ç½®</h2>
            <div class="settings-container">
                <div class="language-selector">
                    <div class="language-option active" data-lang="zh-CN">ç®€ä½“ä¸­æ–‡</div>
                    <div class="language-option" data-lang="zh-TW">ç¹é«”ä¸­æ–‡</div>
                    <div class="language-option" data-lang="en">English</div>
                    <div class="language-option" data-lang="ja">æ—¥æœ¬èª</div>
                </div>
                
                <div class="settings-section">
                    <h3 class="settings-title" data-translate="personalInfo">ä¸ªäººä¿¡æ¯</h3>
                    <div class="form-group">
                        <label class="form-label" for="myCallsign" data-translate="myCallsign">æˆ‘çš„å‘¼å·</label>
                        <input type="text" id="myCallsign" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="myGrid" data-translate="myGrid">æˆ‘çš„GRIDç½‘æ ¼</label>
                        <input type="text" id="myGrid" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="myCQZone" data-translate="myCQZone">æˆ‘çš„CQåˆ†åŒº</label>
                        <input type="text" id="myCQZone" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="myITUZone" data-translate="myITUZone">æˆ‘çš„ITUåˆ†åŒº</label>
                        <input type="text" id="myITUZone" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="myEquipment" data-translate="myEquipment">ä½¿ç”¨è®¾å¤‡</label>
                        <input type="text" id="myEquipment" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="myAntenna" data-translate="myAntenna">ä½¿ç”¨å¤©çº¿</label>
                        <input type="text" id="myAntenna" class="form-control">
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="settings-title" data-translate="displaySettings">æ˜¾ç¤ºè®¾ç½®</h3>
                    <div class="form-group">
                        <label class="form-label" data-translate="themeMode">ä¸»é¢˜æ¨¡å¼</label>
                        <div class="theme-toggle">
                            <div class="theme-option active" data-theme="light" data-translate="light">æµ…è‰²</div>
                            <div class="theme-option" data-theme="dark" data-translate="dark">æ·±è‰²</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-translate="timeDisplay">æ—¶é—´æ˜¾ç¤º</label>
                        <div class="theme-toggle">
                            <div class="theme-option active" data-timezone="BJT">BJT</div>
                            <div class="theme-option" data-timezone="UTC">UTC</div>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="settings-title" data-translate="about">å…³äº</h3>
                    <div class="about-info">
                        <div class="about-title">ELVES</div>
                        <div class="about-text">
                            <span data-translate="developedBy">Â© 2025 | pyseafish (BG5DHV)</span><br>
                            v1.10.1.20251013
                            <br>
                            <a href="https://github.com/pyseafish/ELVES" style="color: var(--text-color); text-decoration: none; font-size: 0.95rem;">Open source under MIT license</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å¯¼å‡ºé¡µé¢ -->
        <div class="page" id="exportPage">
            <h2 style="text-align: center; margin-bottom: 20px;" data-translate="exportRecords">å¯¼å‡ºè®°å½•</h2>
            <div class="form-container">
                <div class="form-group">
                    <label class="form-label" for="exportDateFrom" data-translate="startDate">å¼€å§‹æ—¥æœŸ</label>
                    <input type="date" id="exportDateFrom" class="form-control">
                </div>
                <div class="form-group">
                    <label class="form-label" for="exportDateTo" data-translate="endDate">ç»“æŸæ—¥æœŸ</label>
                    <input type="date" id="exportDateTo" class="form-control">
                </div>
                <div class="form-group">
                    <label class="form-label" data-translate="contestFilter">æ¯”èµ›ç­›é€‰</label>
                    <div class="custom-select" id="exportContestSelect">
                        <div class="custom-select-header">
                            <span id="exportContestValue" data-translate="allRecords">å…¨éƒ¨è®°å½•</span>
                            <span>â–¼</span>
                        </div>
                        <div class="custom-select-options" id="exportContestOptions">
                            <div class="custom-select-option" data-value="">å…¨éƒ¨è®°å½•</div>
                            <div class="custom-select-option" data-value="CQWPX">CQ WPX</div>
                            <div class="custom-select-option" data-value="CQWW">CQWW</div>
                            <div class="custom-select-option" data-value="WAPC">WAPC</div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="exportFilename" data-translate="exportFilename">å¯¼å‡ºæ–‡ä»¶å</label>
                    <input type="text" id="exportFilename" class="form-control" placeholder="my_ham_log">
                </div>
                <div class="form-group">
                    <label class="form-label" data-translate="exportFormat">å¯¼å‡ºæ ¼å¼</label>
                    <div class="theme-toggle">
                        <div class="theme-option active" data-format="adi">ADI</div>
                        <div class="theme-option" data-format="cabrillo">Cabrillo</div>
                    </div>
                </div>
                <div class="form-group">
                    <button class="btn btn-primary" id="generateExportBtn" style="width: 100%;" data-translate="generateExport">ç”Ÿæˆå¯¼å‡ºæ–‡ä»¶</button>
                </div>
                <div class="form-group" id="exportResult" style="display: none;">
                    <label class="form-label" data-translate="exportContent">å¯¼å‡ºå†…å®¹</label>
                    <textarea id="exportContent" class="form-control" rows="10" readonly></textarea>
                    <button class="btn btn-primary" id="downloadBtn" style="margin-top: 10px; width: 100%;" data-translate="downloadFile">ä¸‹è½½æ–‡ä»¶</button>
                </div>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨å¯¼èˆª -->
    <div class="footer">
        <div class="nav-tabs">
            <div class="nav-tab active" data-page="recordsPage">
                <div class="nav-icon">ğŸ“</div>
                <div class="nav-label" data-translate="records">è®°å½•</div>
            </div>
            <div class="nav-tab" data-page="addPage">
                <div class="nav-icon">â•</div>
                <div class="nav-label" data-translate="add">æ–°å¢</div>
            </div>
            <div class="nav-tab" data-page="settingsPage">
                <div class="nav-icon">âš™ï¸</div>
                <div class="nav-label" data-translate="settings">è®¾ç½®</div>
            </div>
            <div class="nav-tab" data-page="exportPage">
                <div class="nav-icon">ğŸ“¤</div>
                <div class="nav-label" data-translate="export">å¯¼å‡º</div>
            </div>
        </div>
    </div>

    <!-- æ¨¡æ€æ¡† -->
    <div class="modal" id="confirmationModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" data-translate="confirmAction">ç¡®è®¤æ“ä½œ</div>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>
            <div class="modal-body" id="modalMessage">
                <!-- æ¶ˆæ¯å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="modalCancel" data-translate="cancel">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="modalConfirm" data-translate="confirm">ç¡®è®¤</button>
            </div>
        </div>
    </div>

    <script>
        // åº”ç”¨çŠ¶æ€ç®¡ç†
        const AppState = {
            records: [],
            settings: {
                myCallsign: '',
                myGrid: '',
                myCQZone: '',
                myITUZone: '',
                myEquipment: '',
                myAntenna: '',
                theme: 'light',
                timezone: 'BJT',
                language: 'zh-CN'
            },
            currentEditingRecord: null,
            filters: {
                dateFrom: null,
                dateTo: null,
                callsign: '',
                grid: '',
                contest: ''
            },
            modalCallback: null
        };

        // å¤šè¯­è¨€æ”¯æŒ
        const Translations = {
            'zh-CN': {
                'noCallsign': 'æœªè®¾ç½®å‘¼å·',
                'noRecords': 'æš‚æ— é€šè”è®°å½•',
                'addRecordHint': 'ç‚¹å‡»åº•éƒ¨"æ–°å¢"å¼€å§‹è®°å½•',
                'deleteConfirm': 'ç¡®å®šè¦åˆ é™¤è¿™æ¡é€šè”è®°å½•å—ï¼Ÿ',
                'updateConfirm': 'ç¡®å®šè¦æ›´æ–°è¿™æ¡é€šè”è®°å½•å—ï¼Ÿ',
                'importSuccess': 'æˆåŠŸå¯¼å…¥ {count} æ¡è®°å½•',
                'importPartial': 'æˆåŠŸå¯¼å…¥ {count} æ¡è®°å½•ï¼Œè·³è¿‡ {skipped} æ¡é‡å¤è®°å½•',
                'importFailed': 'æ— æ³•è§£ææ–‡ä»¶å†…å®¹ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼',
                'duplicateFound': 'å‘ç°é‡å¤è®°å½•ï¼Œæ˜¯å¦ç¡®è®¤æ·»åŠ ï¼Ÿ',
                'records': 'è®°å½•',
                'add': 'æ–°å¢',
                'settings': 'è®¾ç½®',
                'export': 'å¯¼å‡º',
                'filterConditions': 'ç­›é€‰æ¡ä»¶',
                'startDate': 'å¼€å§‹æ—¥æœŸ',
                'endDate': 'ç»“æŸæ—¥æœŸ',
                'callsign': 'å‘¼å·',
                'grid': 'ç½‘æ ¼åæ ‡',
                'contest': 'æ¯”èµ›',
                'all': 'å…¨éƒ¨',
                'applyFilter': 'åº”ç”¨ç­›é€‰',
                'clearFilter': 'æ¸…é™¤ç­›é€‰',
                'addRecord': 'æ–°å¢é€šè”è®°å½•',
                'contestSelection': 'æ¯”èµ›é€‰æ‹©',
                'noContest': 'æ— æ¯”èµ›',
                'theirCallsign': 'å¯¹æ–¹å‘¼å·',
                'frequency': 'é¢‘ç‡ (MHz)',
                'mode': 'æ¨¡å¼',
                'date': 'æ—¥æœŸ',
                'time': 'æ—¶é—´',
                'sentReport': 'å‘é€ä¿¡å·æŠ¥å‘Š',
                'receivedReport': 'æ¥æ”¶ä¿¡å·æŠ¥å‘Š',
                'serialNumber': 'åºåˆ—å·',
                'cqZone': 'CQåˆ†åŒº',
                'qsoNumber': 'QSOåºå·',
                'provinceAbbr': 'çœå¸‚åŒºç¼©å†™',
                'theirName': 'å¯¹æ–¹å§“å',
                'theirLocation': 'å¯¹æ–¹ä½ç½®',
                'theirGrid': 'å¯¹æ–¹ç½‘æ ¼åæ ‡',
                'remarks': 'å¤‡æ³¨',
                'importLog': 'å¯¼å…¥æ—¥å¿—',
                'saveRecord': 'ä¿å­˜è®°å½•',
                'personalInfo': 'ä¸ªäººä¿¡æ¯',
                'myCallsign': 'æˆ‘çš„å‘¼å·',
                'myGrid': 'æˆ‘çš„GRIDç½‘æ ¼',
                'myCQZone': 'æˆ‘çš„CQåˆ†åŒº',
                'myITUZone': 'æˆ‘çš„ITUåˆ†åŒº',
                'myEquipment': 'ä½¿ç”¨è®¾å¤‡',
                'myAntenna': 'ä½¿ç”¨å¤©çº¿',
                'displaySettings': 'æ˜¾ç¤ºè®¾ç½®',
                'themeMode': 'ä¸»é¢˜æ¨¡å¼',
                'light': 'æµ…è‰²',
                'dark': 'æ·±è‰²',
                'timeDisplay': 'æ—¶é—´æ˜¾ç¤º',
                'about': 'å…³äº',
                'developedBy': 'ç”±BG5DHVå¼€å‘',
                'exportRecords': 'å¯¼å‡ºè®°å½•',
                'contestFilter': 'æ¯”èµ›ç­›é€‰',
                'allRecords': 'å…¨éƒ¨è®°å½•',
                'exportFilename': 'å¯¼å‡ºæ–‡ä»¶å',
                'exportFormat': 'å¯¼å‡ºæ ¼å¼',
                'generateExport': 'ç”Ÿæˆå¯¼å‡ºæ–‡ä»¶',
                'exportContent': 'å¯¼å‡ºå†…å®¹',
                'downloadFile': 'ä¸‹è½½æ–‡ä»¶',
                'confirmAction': 'ç¡®è®¤æ“ä½œ',
                'cancel': 'å–æ¶ˆ',
                'confirm': 'ç¡®è®¤'
            },
            'zh-TW': {
                'noCallsign': 'æœªè¨­ç½®å‘¼è™Ÿ',
                'noRecords': 'æš«ç„¡é€šè¯è¨˜éŒ„',
                'addRecordHint': 'é»æ“Šåº•éƒ¨"æ–°å¢"é–‹å§‹è¨˜éŒ„',
                'deleteConfirm': 'ç¢ºå®šè¦åˆªé™¤é€™æ¢é€šè¯è¨˜éŒ„å—ï¼Ÿ',
                'updateConfirm': 'ç¢ºå®šè¦æ›´æ–°é€™æ¢é€šè¯è¨˜éŒ„å—ï¼Ÿ',
                'importSuccess': 'æˆåŠŸå°å…¥ {count} æ¢è¨˜éŒ„',
                'importPartial': 'æˆåŠŸå°å…¥ {count} æ¢è¨˜éŒ„ï¼Œè·³é {skipped} æ¢é‡è¤‡è¨˜éŒ„',
                'importFailed': 'ç„¡æ³•è§£ææ–‡ä»¶å…§å®¹ï¼Œè«‹æª¢æŸ¥æ–‡ä»¶æ ¼å¼',
                'duplicateFound': 'ç™¼ç¾é‡è¤‡è¨˜éŒ„ï¼Œæ˜¯å¦ç¢ºèªæ·»åŠ ï¼Ÿ',
                'records': 'è¨˜éŒ„',
                'add': 'æ–°å¢',
                'settings': 'è¨­ç½®',
                'export': 'å°å‡º',
                'filterConditions': 'ç¯©é¸æ¢ä»¶',
                'startDate': 'é–‹å§‹æ—¥æœŸ',
                'endDate': 'çµæŸæ—¥æœŸ',
                'callsign': 'å‘¼è™Ÿ',
                'grid': 'ç¶²æ ¼åæ¨™',
                'contest': 'æ¯”è³½',
                'all': 'å…¨éƒ¨',
                'applyFilter': 'æ‡‰ç”¨ç¯©é¸',
                'clearFilter': 'æ¸…é™¤ç¯©é¸',
                'addRecord': 'æ–°å¢é€šè¯è¨˜éŒ„',
                'contestSelection': 'æ¯”è³½é¸æ“‡',
                'noContest': 'ç„¡æ¯”è³½',
                'theirCallsign': 'å°æ–¹å‘¼è™Ÿ',
                'frequency': 'é »ç‡ (MHz)',
                'mode': 'æ¨¡å¼',
                'date': 'æ—¥æœŸ',
                'time': 'æ™‚é–“',
                'sentReport': 'ç™¼é€ä¿¡è™Ÿå ±å‘Š',
                'receivedReport': 'æ¥æ”¶ä¿¡è™Ÿå ±å‘Š',
                'serialNumber': 'åºåˆ—è™Ÿ',
                'cqZone': 'CQåˆ†å€',
                'qsoNumber': 'QSOåºè™Ÿ',
                'provinceAbbr': 'çœå¸‚å€ç¸®å¯«',
                'theirName': 'å°æ–¹å§“å',
                'theirLocation': 'å°æ–¹ä½ç½®',
                'theirGrid': 'å°æ–¹ç¶²æ ¼åæ¨™',
                'remarks': 'å‚™è¨»',
                'importLog': 'å°å…¥æ—¥èªŒ',
                'saveRecord': 'ä¿å­˜è¨˜éŒ„',
                'personalInfo': 'å€‹äººä¿¡æ¯',
                'myCallsign': 'æˆ‘çš„å‘¼è™Ÿ',
                'myGrid': 'æˆ‘çš„GRIDç¶²æ ¼',
                'myCQZone': 'æˆ‘çš„CQåˆ†å€',
                'myITUZone': 'æˆ‘çš„ITUåˆ†å€',
                'myEquipment': 'ä½¿ç”¨è¨­å‚™',
                'myAntenna': 'ä½¿ç”¨å¤©ç·š',
                'displaySettings': 'é¡¯ç¤ºè¨­ç½®',
                'themeMode': 'ä¸»é¡Œæ¨¡å¼',
                'light': 'æ·ºè‰²',
                'dark': 'æ·±è‰²',
                'timeDisplay': 'æ™‚é–“é¡¯ç¤º',
                'about': 'é—œæ–¼',
                'developedBy': 'ç”±BG5DHVé–‹ç™¼',
                'exportRecords': 'å°å‡ºè¨˜éŒ„',
                'contestFilter': 'æ¯”è³½ç¯©é¸',
                'allRecords': 'å…¨éƒ¨è¨˜éŒ„',
                'exportFilename': 'å°å‡ºæ–‡ä»¶å',
                'exportFormat': 'å°å‡ºæ ¼å¼',
                'generateExport': 'ç”Ÿæˆå°å‡ºæ–‡ä»¶',
                'exportContent': 'å°å‡ºå…§å®¹',
                'downloadFile': 'ä¸‹è¼‰æ–‡ä»¶',
                'confirmAction': 'ç¢ºèªæ“ä½œ',
                'cancel': 'å–æ¶ˆ',
                'confirm': 'ç¢ºèª'
            },
            'en': {
                'noCallsign': 'No Callsign Set',
                'noRecords': 'No QSO Records',
                'addRecordHint': 'Tap "Add" below to start logging',
                'deleteConfirm': 'Are you sure you want to delete this QSO?',
                'updateConfirm': 'Are you sure you want to update this QSO?',
                'importSuccess': 'Successfully imported {count} records',
                'importPartial': 'Successfully imported {count} records, skipped {skipped} duplicates',
                'importFailed': 'Unable to parse file content, please check file format',
                'duplicateFound': 'Duplicate record found, confirm to add?',
                'records': 'Records',
                'add': 'Add',
                'settings': 'Settings',
                'export': 'Export',
                'filterConditions': 'Filter Conditions',
                'startDate': 'Start Date',
                'endDate': 'End Date',
                'callsign': 'Callsign',
                'grid': 'Grid Square',
                'contest': 'Contest',
                'all': 'All',
                'applyFilter': 'Apply Filter',
                'clearFilter': 'Clear Filter',
                'addRecord': 'Add QSO Record',
                'contestSelection': 'Contest Selection',
                'noContest': 'No Contest',
                'theirCallsign': 'Their Callsign',
                'frequency': 'Frequency (MHz)',
                'mode': 'Mode',
                'date': 'Date',
                'time': 'Time',
                'sentReport': 'Sent Report',
                'receivedReport': 'Received Report',
                'serialNumber': 'Serial Number',
                'cqZone': 'CQ Zone',
                'qsoNumber': 'QSO Number',
                'provinceAbbr': 'Province Abbreviation',
                'theirName': 'Their Name',
                'theirLocation': 'Their Location',
                'theirGrid': 'Their Grid Square',
                'remarks': 'Remarks',
                'importLog': 'Import Log',
                'saveRecord': 'Save Record',
                'personalInfo': 'Personal Info',
                'myCallsign': 'My Callsign',
                'myGrid': 'My GRID Square',
                'myCQZone': 'My CQ Zone',
                'myITUZone': 'My ITU Zone',
                'myEquipment': 'My Equipment',
                'myAntenna': 'My Antenna',
                'displaySettings': 'Display Settings',
                'themeMode': 'Theme Mode',
                'light': 'Light',
                'dark': 'Dark',
                'timeDisplay': 'Time Display',
                'about': 'About',
                'developedBy': 'Developed by BG5DHV',
                'exportRecords': 'Export Records',
                'contestFilter': 'Contest Filter',
                'allRecords': 'All Records',
                'exportFilename': 'Export Filename',
                'exportFormat': 'Export Format',
                'generateExport': 'Generate Export',
                'exportContent': 'Export Content',
                'downloadFile': 'Download File',
                'confirmAction': 'Confirm Action',
                'cancel': 'Cancel',
                'confirm': 'Confirm'
            },
            'ja': {
                'noCallsign': 'ã‚³ãƒ¼ãƒ«ã‚µã‚¤ãƒ³æœªè¨­å®š',
                'noRecords': 'QSOè¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“',
                'addRecordHint': 'ä¸‹éƒ¨ã®ã€Œè¿½åŠ ã€ã‚’ã‚¿ãƒƒãƒ—ã—ã¦è¨˜éŒ²ã‚’é–‹å§‹',
                'deleteConfirm': 'ã“ã®QSOã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ',
                'updateConfirm': 'ã“ã®QSOã‚’æ›´æ–°ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ',
                'importSuccess': '{count}ä»¶ã®è¨˜éŒ²ã‚’æ­£å¸¸ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ',
                'importPartial': '{count}ä»¶ã®è¨˜éŒ²ã‚’æ­£å¸¸ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸã€{skipped}ä»¶ã®é‡è¤‡ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã—ãŸ',
                'importFailed': 'ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’è§£æã§ãã¾ã›ã‚“ã€‚ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„',
                'duplicateFound': 'é‡è¤‡ã™ã‚‹è¨˜éŒ²ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚è¿½åŠ ã—ã¾ã™ã‹ï¼Ÿ',
                'records': 'è¨˜éŒ²',
                'add': 'è¿½åŠ ',
                'settings': 'è¨­å®š',
                'export': 'ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ',
                'filterConditions': 'ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ¡ä»¶',
                'startDate': 'é–‹å§‹æ—¥',
                'endDate': 'çµ‚äº†æ—¥',
                'callsign': 'ã‚³ãƒ¼ãƒ«ã‚µã‚¤ãƒ³',
                'grid': 'ã‚°ãƒªãƒƒãƒ‰ã‚¹ã‚¯ã‚¨ã‚¢',
                'contest': 'ã‚³ãƒ³ãƒ†ã‚¹ãƒˆ',
                'all': 'ã™ã¹ã¦',
                'applyFilter': 'ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é©ç”¨',
                'clearFilter': 'ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ã‚¯ãƒªã‚¢',
                'addRecord': 'QSOè¨˜éŒ²ã‚’è¿½åŠ ',
                'contestSelection': 'ã‚³ãƒ³ãƒ†ã‚¹ãƒˆé¸æŠ',
                'noContest': 'ã‚³ãƒ³ãƒ†ã‚¹ãƒˆãªã—',
                'theirCallsign': 'ç›¸æ‰‹ã®ã‚³ãƒ¼ãƒ«ã‚µã‚¤ãƒ³',
                'frequency': 'å‘¨æ³¢æ•° (MHz)',
                'mode': 'ãƒ¢ãƒ¼ãƒ‰',
                'date': 'æ—¥ä»˜',
                'time': 'æ™‚é–“',
                'sentReport': 'é€ä¿¡ãƒ¬ãƒãƒ¼ãƒˆ',
                'receivedReport': 'å—ä¿¡ãƒ¬ãƒãƒ¼ãƒˆ',
                'serialNumber': 'ã‚·ãƒªã‚¢ãƒ«ç•ªå·',
                'cqZone': 'CQã‚¾ãƒ¼ãƒ³',
                'qsoNumber': 'QSOç•ªå·',
                'provinceAbbr': 'éƒ½é“åºœçœŒç•¥ç§°',
                'theirName': 'ç›¸æ‰‹ã®åå‰',
                'theirLocation': 'ç›¸æ‰‹ã®å ´æ‰€',
                'theirGrid': 'ç›¸æ‰‹ã®ã‚°ãƒªãƒƒãƒ‰ã‚¹ã‚¯ã‚¨ã‚¢',
                'remarks': 'å‚™è€ƒ',
                'importLog': 'ãƒ­ã‚°ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ',
                'saveRecord': 'è¨˜éŒ²ã‚’ä¿å­˜',
                'personalInfo': 'å€‹äººæƒ…å ±',
                'myCallsign': 'ç§ã®ã‚³ãƒ¼ãƒ«ã‚µã‚¤ãƒ³',
                'myGrid': 'ç§ã®GRIDã‚¹ã‚¯ã‚¨ã‚¢',
                'myCQZone': 'ç§ã®CQã‚¾ãƒ¼ãƒ³',
                'myITUZone': 'ç§ã®ITUã‚¾ãƒ¼ãƒ³',
                'myEquipment': 'ä½¿ç”¨æ©Ÿå™¨',
                'myAntenna': 'ä½¿ç”¨ã‚¢ãƒ³ãƒ†ãƒŠ',
                'displaySettings': 'è¡¨ç¤ºè¨­å®š',
                'themeMode': 'ãƒ†ãƒ¼ãƒãƒ¢ãƒ¼ãƒ‰',
                'light': 'ãƒ©ã‚¤ãƒˆ',
                'dark': 'ãƒ€ãƒ¼ã‚¯',
                'timeDisplay': 'æ™‚é–“è¡¨ç¤º',
                'about': 'ã«ã¤ã„ã¦',
                'developedBy': 'BG5DHVé–‹ç™º',
                'exportRecords': 'è¨˜éŒ²ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ',
                'contestFilter': 'ã‚³ãƒ³ãƒ†ã‚¹ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼',
                'allRecords': 'ã™ã¹ã¦ã®è¨˜éŒ²',
                'exportFilename': 'ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å',
                'exportFormat': 'ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå½¢å¼',
                'generateExport': 'ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ',
                'exportContent': 'ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå†…å®¹',
                'downloadFile': 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰',
                'confirmAction': 'æ“ä½œã‚’ç¢ºèª',
                'cancel': 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«',
                'confirm': 'ç¢ºèª'
            }
        };

        // DOM åŠ è½½å®Œæˆååˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', function() {
            // åŠ è½½ä¿å­˜çš„æ•°æ®
            loadData();
            
            // åˆå§‹åŒ–UI
            initUI();
            
            // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
            setupEventListeners();
            
            // æ›´æ–°æ—¶é—´æ˜¾ç¤º
            updateTime();
            setInterval(updateTime, 1000);
        });

        // åŠ è½½æœ¬åœ°å­˜å‚¨çš„æ•°æ®
        function loadData() {
            const savedRecords = localStorage.getItem('hamRadioRecords');
            const savedSettings = localStorage.getItem('hamRadioSettings');
            
            if (savedRecords) {
                AppState.records = JSON.parse(savedRecords);
            }
            
            if (savedSettings) {
                AppState.settings = {...AppState.settings, ...JSON.parse(savedSettings)};
            }
        }

        // ä¿å­˜æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
        function saveData() {
            localStorage.setItem('hamRadioRecords', JSON.stringify(AppState.records));
            localStorage.setItem('hamRadioSettings', JSON.stringify(AppState.settings));
        }

        // åˆå§‹åŒ–UI
        function initUI() {
            // æ›´æ–°é¡¶éƒ¨æ å‘¼å·æ˜¾ç¤º
            document.getElementById('userCallsign').textContent = 
                AppState.settings.myCallsign || getTranslation('noCallsign');
            
            // åº”ç”¨ä¸»é¢˜è®¾ç½®
            document.documentElement.setAttribute('data-theme', AppState.settings.theme);
            
            // æ›´æ–°è®¾ç½®è¡¨å•
            document.getElementById('myCallsign').value = AppState.settings.myCallsign;
            document.getElementById('myGrid').value = AppState.settings.myGrid;
            document.getElementById('myCQZone').value = AppState.settings.myCQZone;
            document.getElementById('myITUZone').value = AppState.settings.myITUZone;
            document.getElementById('myEquipment').value = AppState.settings.myEquipment;
            document.getElementById('myAntenna').value = AppState.settings.myAntenna;
            
            // è®¾ç½®ä¸»é¢˜é€‰é¡¹
            document.querySelectorAll('.theme-option[data-theme]').forEach(option => {
                option.classList.toggle('active', option.dataset.theme === AppState.settings.theme);
            });
            
            // è®¾ç½®æ—¶åŒºé€‰é¡¹
            document.querySelectorAll('.theme-option[data-timezone]').forEach(option => {
                option.classList.toggle('active', option.dataset.timezone === AppState.settings.timezone);
            });
            
            // è®¾ç½®è¯­è¨€é€‰é¡¹
            document.querySelectorAll('.language-option').forEach(option => {
                option.classList.toggle('active', option.dataset.lang === AppState.settings.language);
            });
            
            // æ¸²æŸ“è®°å½•åˆ—è¡¨
            renderRecords();
            
            // åº”ç”¨å¤šè¯­è¨€
            applyTranslations();
        }

        // è·å–ç¿»è¯‘æ–‡æœ¬
        function getTranslation(key, params = {}) {
            const lang = AppState.settings.language || 'zh-CN';
            let text = Translations[lang][key] || Translations['zh-CN'][key] || key;
            
            // æ›¿æ¢å‚æ•°
            Object.keys(params).forEach(param => {
                text = text.replace(`{${param}}`, params[param]);
            });
            
            return text;
        }

        // åº”ç”¨å¤šè¯­è¨€ç¿»è¯‘
        function applyTranslations() {
            // æ›´æ–°æ‰€æœ‰å¸¦æœ‰data-translateå±æ€§çš„å…ƒç´ 
            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                element.textContent = getTranslation(key);
            });
            
            // æ›´æ–°ç©ºçŠ¶æ€
            const emptyState = document.querySelector('.empty-state');
            if (emptyState) {
                emptyState.querySelector('.empty-text').textContent = getTranslation('noRecords');
                emptyState.querySelector('.empty-subtext').textContent = getTranslation('addRecordHint');
            }
            
            // æ›´æ–°é¡¶éƒ¨æ å‘¼å·
            document.getElementById('userCallsign').textContent = 
                AppState.settings.myCallsign || getTranslation('noCallsign');
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // åº•éƒ¨å¯¼èˆªåˆ‡æ¢
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const pageId = this.dataset.page;
                    switchPage(pageId);
                    
                    // æ›´æ–°æ´»åŠ¨æ ‡ç­¾
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // ç­›é€‰åŒºåŸŸåˆ‡æ¢
            document.getElementById('filterToggle').addEventListener('click', function() {
                const content = document.getElementById('filterContent');
                content.classList.toggle('expanded');
                this.querySelector('div').textContent = content.classList.contains('expanded') ? 'â–²' : 'â–¼';
            });
            
            // ä¿å­˜è®°å½•æŒ‰é’®
            document.getElementById('saveRecordBtn').addEventListener('click', saveRecord);
            
            // è®¾ç½®è¡¨å•ä¿å­˜
            document.getElementById('myCallsign').addEventListener('change', saveSettings);
            document.getElementById('myGrid').addEventListener('change', saveSettings);
            document.getElementById('myCQZone').addEventListener('change', saveSettings);
            document.getElementById('myITUZone').addEventListener('change', saveSettings);
            document.getElementById('myEquipment').addEventListener('change', saveSettings);
            document.getElementById('myAntenna').addEventListener('change', saveSettings);
            
            // ä¸»é¢˜åˆ‡æ¢
            document.querySelectorAll('.theme-option[data-theme]').forEach(option => {
                option.addEventListener('click', function() {
                    AppState.settings.theme = this.dataset.theme;
                    saveSettings();
                    document.documentElement.setAttribute('data-theme', AppState.settings.theme);
                    
                    // æ›´æ–°æ´»åŠ¨é€‰é¡¹
                    document.querySelectorAll('.theme-option[data-theme]').forEach(opt => {
                        opt.classList.toggle('active', opt.dataset.theme === AppState.settings.theme);
                    });
                });
            });
            
            // æ—¶åŒºåˆ‡æ¢
            document.querySelectorAll('.theme-option[data-timezone]').forEach(option => {
                option.addEventListener('click', function() {
                    AppState.settings.timezone = this.dataset.timezone;
                    saveSettings();
                    
                    // æ›´æ–°æ´»åŠ¨é€‰é¡¹
                    document.querySelectorAll('.theme-option[data-timezone]').forEach(opt => {
                        opt.classList.toggle('active', opt.dataset.timezone === AppState.settings.timezone);
                    });
                    
                    updateTime();
                });
            });
            
            // è¯­è¨€åˆ‡æ¢
            document.querySelectorAll('.language-option').forEach(option => {
                option.addEventListener('click', function() {
                    AppState.settings.language = this.dataset.lang;
                    saveSettings();
                    
                    // æ›´æ–°æ´»åŠ¨é€‰é¡¹
                    document.querySelectorAll('.language-option').forEach(opt => {
                        opt.classList.toggle('active', opt.dataset.lang === AppState.settings.language);
                    });
                    
                    applyTranslations();
                    renderRecords();
                });
            });
            
            // å¯¼å…¥æ–‡ä»¶
            document.getElementById('importFile').addEventListener('change', handleFileImport);
            
            // åº”ç”¨ç­›é€‰æŒ‰é’®
            document.getElementById('applyFilterBtn').addEventListener('click', applyFilters);
            
            // æ¸…é™¤ç­›é€‰æŒ‰é’®
            document.getElementById('clearFilterBtn').addEventListener('click', clearFilters);
            
            // å¯¼å‡ºæ ¼å¼é€‰æ‹©
            document.querySelectorAll('.theme-option[data-format]').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.theme-option[data-format]').forEach(opt => {
                        opt.classList.remove('active');
                    });
                    this.classList.add('active');
                });
            });
            
            // ç”Ÿæˆå¯¼å‡ºæ–‡ä»¶
            document.getElementById('generateExportBtn').addEventListener('click', generateExport);
            
            // ä¸‹è½½æ–‡ä»¶
            document.getElementById('downloadBtn').addEventListener('click', downloadExport);
            
            // æ¨¡æ€æ¡†äº‹ä»¶
            document.getElementById('modalClose').addEventListener('click', closeModal);
            document.getElementById('modalCancel').addEventListener('click', closeModal);
            document.getElementById('modalConfirm').addEventListener('click', function() {
                if (AppState.modalCallback) {
                    AppState.modalCallback();
                }
                closeModal();
            });
            
            // è‡ªå®šä¹‰é€‰æ‹©å™¨äº‹ä»¶
            setupCustomSelectors();
            
            // æ¯”èµ›é€‰æ‹©å˜åŒ–äº‹ä»¶
            document.getElementById('contestSelect').addEventListener('change', function() {
                updateContestFields();
            });
        }

        // è®¾ç½®è‡ªå®šä¹‰é€‰æ‹©å™¨
        function setupCustomSelectors() {
            // ä¸ºæ‰€æœ‰è‡ªå®šä¹‰é€‰æ‹©å™¨æ·»åŠ äº‹ä»¶
            document.querySelectorAll('.custom-select').forEach(select => {
                const header = select.querySelector('.custom-select-header');
                const options = select.querySelector('.custom-select-options');
                const valueSpan = select.querySelector('span:first-child');
                
                // ç‚¹å‡»æ ‡é¢˜å±•å¼€/æ”¶èµ·é€‰é¡¹
                header.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const isActive = options.classList.contains('active');
                    
                    // å…³é—­æ‰€æœ‰å…¶ä»–é€‰æ‹©å™¨
                    document.querySelectorAll('.custom-select-options').forEach(opt => {
                        opt.classList.remove('active');
                    });
                    
                    // åˆ‡æ¢å½“å‰é€‰æ‹©å™¨
                    if (!isActive) {
                        options.classList.add('active');
                    }
                });
                
                // ç‚¹å‡»é€‰é¡¹
                options.querySelectorAll('.custom-select-option').forEach(option => {
                    option.addEventListener('click', function() {
                        const value = this.getAttribute('data-value');
                        const text = this.textContent;
                        
                        valueSpan.textContent = text;
                        valueSpan.setAttribute('data-value', value);
                        
                        // è§¦å‘changeäº‹ä»¶
                        select.dispatchEvent(new Event('change'));
                        
                        // å…³é—­é€‰é¡¹åˆ—è¡¨
                        options.classList.remove('active');
                    });
                });
            });
            
            // ç‚¹å‡»é¡µé¢å…¶ä»–åŒºåŸŸå…³é—­æ‰€æœ‰é€‰æ‹©å™¨
            document.addEventListener('click', function() {
                document.querySelectorAll('.custom-select-options').forEach(options => {
                    options.classList.remove('active');
                });
            });
        }

        // æ›´æ–°æ¯”èµ›ç‰¹å®šå­—æ®µæ˜¾ç¤º
        function updateContestFields() {
            const contestSelect = document.getElementById('contestSelect');
            const contestValue = contestSelect.querySelector('span:first-child').getAttribute('data-value');
            const contestFields = document.getElementById('contestFields');
            
            // éšè—æ‰€æœ‰æ¯”èµ›ç‰¹å®šå­—æ®µ
            document.getElementById('serialField').style.display = 'none';
            document.getElementById('cqzoneField').style.display = 'none';
            document.getElementById('qsosNumberField').style.display = 'none';
            document.getElementById('provinceField').style.display = 'none';
            
            // æ ¹æ®é€‰æ‹©çš„æ¯”èµ›æ˜¾ç¤ºç‰¹å®šå­—æ®µ
            if (contestValue === 'CQWPX') {
                contestFields.style.display = 'block';
                document.getElementById('serialField').style.display = 'block';
            } else if (contestValue === 'CQWW') {
                contestFields.style.display = 'block';
                document.getElementById('cqzoneField').style.display = 'block';
            } else if (contestValue === 'WAPC') {
                contestFields.style.display = 'block';
                document.getElementById('qsosNumberField').style.display = 'block';
                document.getElementById('provinceField').style.display = 'block';
            } else {
                contestFields.style.display = 'none';
            }
        }

        // åˆ‡æ¢é¡µé¢
        function switchPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            
            // å¦‚æœæ˜¯è®°å½•é¡µé¢ï¼Œåˆ·æ–°è®°å½•åˆ—è¡¨
            if (pageId === 'recordsPage') {
                renderRecords();
            }
            
            // å¦‚æœæ˜¯æ–°å¢é¡µé¢ï¼Œæ¸…ç©ºè¡¨å•
            if (pageId === 'addPage') {
                clearForm();
            }
        }

        // æ›´æ–°æ—¶é—´æ˜¾ç¤º
        function updateTime() {
            const now = new Date();
            let timeString;
            
            if (AppState.settings.timezone === 'UTC') {
                const utcHours = now.getUTCHours().toString().padStart(2, '0');
                const utcMinutes = now.getUTCMinutes().toString().padStart(2, '0');
                const utcSeconds = now.getUTCSeconds().toString().padStart(2, '0');
                timeString = `${utcHours}:${utcMinutes}:${utcSeconds} UTC`;
            } else {
                const bjtHours = now.getHours().toString().padStart(2, '0');
                const bjtMinutes = now.getMinutes().toString().padStart(2, '0');
                const bjtSeconds = now.getSeconds().toString().padStart(2, '0');
                timeString = `${bjtHours}:${bjtMinutes}:${bjtSeconds} BJT`;
            }
            
            document.getElementById('currentTime').textContent = timeString;
        }

        // æ¸²æŸ“è®°å½•åˆ—è¡¨
        function renderRecords() {
            const container = document.getElementById('recordsContainer');
            
            // åº”ç”¨ç­›é€‰
            let filteredRecords = [...AppState.records];
            
            if (AppState.filters.dateFrom) {
                filteredRecords = filteredRecords.filter(record => {
                    const recordDate = new Date(record.date);
                    return recordDate >= new Date(AppState.filters.dateFrom);
                });
            }
            
            if (AppState.filters.dateTo) {
                filteredRecords = filteredRecords.filter(record => {
                    const recordDate = new Date(record.date);
                    const filterDate = new Date(AppState.filters.dateTo);
                    filterDate.setDate(filterDate.getDate() + 1); // åŒ…å«ç»“æŸæ—¥æœŸå½“å¤©
                    return recordDate < filterDate;
                });
            }
            
            if (AppState.filters.callsign) {
                filteredRecords = filteredRecords.filter(record => 
                    record.callsign.toLowerCase().includes(AppState.filters.callsign.toLowerCase())
                );
            }
            
            if (AppState.filters.grid) {
                filteredRecords = filteredRecords.filter(record => 
                    record.gridsquare && record.gridsquare.toLowerCase().includes(AppState.filters.grid.toLowerCase())
                );
            }
            
            if (AppState.filters.contest) {
                filteredRecords = filteredRecords.filter(record => 
                    record.contest === AppState.filters.contest
                );
            }
            
            if (filteredRecords.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“¡</div>
                        <div class="empty-text">${getTranslation('noRecords')}</div>
                        <div class="empty-subtext">${getTranslation('addRecordHint')}</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            // æŒ‰æ—¥æœŸæ’åºï¼ˆæœ€æ–°çš„åœ¨å‰é¢ï¼‰
            filteredRecords.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            filteredRecords.forEach((record, index) => {
                // æ‰¾åˆ°è®°å½•åœ¨åŸå§‹æ•°ç»„ä¸­çš„ç´¢å¼•
                const originalIndex = AppState.records.findIndex(r => r.id === record.id);
                
                const card = document.createElement('div');
                card.className = 'record-card collapsed';
                card.dataset.index = originalIndex;
                
                // æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´
                const dateObj = new Date(record.date);
                const dateStr = dateObj.toLocaleDateString('zh-CN');
                const timeStr = dateObj.toLocaleTimeString('zh-CN', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                // æ„å»ºé¢‘ç‡æ˜¾ç¤ºå†…å®¹
                let frequencyDisplay = `${record.frequency} MHz â€¢ ${record.mode}`;
                if (record.contest) {
                    frequencyDisplay = `${record.frequency} MHz â€¢ ${record.mode} <span class="contest-badge">${record.contest}</span>`;
                }
                
                card.innerHTML = `
                    <div class="record-summary">
                        <div class="record-callsign">${record.callsign}</div>
                        <div class="record-datetime">${dateStr} ${timeStr}</div>
                        <div class="record-frequency">${frequencyDisplay}</div>
                    </div>
                    <div class="record-details" style="display: none;">
                        ${record.contest ? `<div class="detail-row">
                            <span class="detail-label">${getTranslation('contest')}:</span>
                            <span class="detail-value">${record.contest}</span>
                        </div>` : ''}
                        ${record.serial ? `<div class="detail-row">
                            <span class="detail-label">${getTranslation('serialNumber')}:</span>
                            <span class="detail-value">${record.serial}</span>
                        </div>` : ''}
                        ${record.cqzone ? `<div class="detail-row">
                            <span class="detail-label">${getTranslation('cqZone')}:</span>
                            <span class="detail-value">${record.cqzone}</span>
                        </div>` : ''}
                        ${record.qsosNumber ? `<div class="detail-row">
                            <span class="detail-label">${getTranslation('qsoNumber')}:</span>
                            <span class="detail-value">${record.qsosNumber}</span>
                        </div>` : ''}
                        ${record.province ? `<div class="detail-row">
                            <span class="detail-label">${getTranslation('provinceAbbr')}:</span>
                            <span class="detail-value">${record.province}</span>
                        </div>` : ''}
                        <div class="detail-row">
                            <span class="detail-label">${getTranslation('theirCallsign')}:</span>
                            <span class="detail-value">${record.callsign}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">${getTranslation('frequency')}:</span>
                            <span class="detail-value">${record.frequency} MHz</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">${getTranslation('mode')}:</span>
                            <span class="detail-value">${record.mode}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">${getTranslation('date')}/${getTranslation('time')}:</span>
                            <span class="detail-value">${dateStr} ${timeStr}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">${getTranslation('sentReport')}:</span>
                            <span class="detail-value">${record.rstSent}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">${getTranslation('receivedReport')}:</span>
                            <span class="detail-value">${record.rstRcvd}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">${getTranslation('theirName')}:</span>
                            <span class="detail-value">${record.name || '-'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">${getTranslation('theirLocation')}:</span>
                            <span class="detail-value">${record.qth || '-'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">${getTranslation('theirGrid')}:</span>
                            <span class="detail-value">${record.gridsquare || '-'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">${getTranslation('remarks')}:</span>
                            <span class="detail-value">${record.comment || '-'}</span>
                        </div>
                        <div class="record-actions">
                            <button class="btn btn-primary edit-record">âœï¸ ${getTranslation('edit')}</button>
                            <button class="btn btn-danger delete-record">ğŸ—‘ï¸ ${getTranslation('delete')}</button>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
                
                // æ·»åŠ å¡ç‰‡ç‚¹å‡»äº‹ä»¶
                card.addEventListener('click', function(e) {
                    if (!e.target.classList.contains('edit-record') && 
                        !e.target.classList.contains('delete-record')) {
                        toggleRecordCard(this);
                    }
                });
                
                // æ·»åŠ ç¼–è¾‘æŒ‰é’®äº‹ä»¶
                card.querySelector('.edit-record').addEventListener('click', function(e) {
                    e.stopPropagation();
                    editRecord(originalIndex);
                });
                
                // æ·»åŠ åˆ é™¤æŒ‰é’®äº‹ä»¶
                card.querySelector('.delete-record').addEventListener('click', function(e) {
                    e.stopPropagation();
                    showConfirmation(getTranslation('deleteConfirm'), () => {
                        deleteRecord(originalIndex);
                    });
                });
            });
        }

        // åˆ‡æ¢è®°å½•å¡ç‰‡å±•å¼€/æ”¶èµ·çŠ¶æ€
        function toggleRecordCard(card) {
            const isExpanded = card.classList.contains('expanded');
            const details = card.querySelector('.record-details');
            
            if (isExpanded) {
                card.classList.remove('expanded');
                card.classList.add('collapsed');
                details.style.display = 'none';
            } else {
                card.classList.remove('collapsed');
                card.classList.add('expanded');
                details.style.display = 'flex';
            }
        }

        // ä¿å­˜è®°å½•
        function saveRecord() {
            const callsign = document.getElementById('callsign').value;
            const frequency = document.getElementById('frequency').value;
            const mode = document.getElementById('modeSelect').querySelector('span:first-child').getAttribute('data-value');
            const date = document.getElementById('date').value;
            const time = document.getElementById('time').value;
            const rstSent = document.getElementById('rstSent').value;
            const rstRcvd = document.getElementById('rstRcvd').value;
            const name = document.getElementById('name').value;
            const qth = document.getElementById('qth').value;
            const gridsquare = document.getElementById('gridsquare').value;
            const comment = document.getElementById('comment').value;
            const contest = document.getElementById('contestSelect').querySelector('span:first-child').getAttribute('data-value');
            
            // è·å–æ¯”èµ›ç‰¹å®šå­—æ®µ
            const serial = document.getElementById('serial').value;
            const cqzone = document.getElementById('cqzone').value;
            const qsosNumber = document.getElementById('qsosNumber').value;
            const province = document.getElementById('province').value;
            
            if (!callsign) {
                showMessage('è¯·è¾“å…¥å¯¹æ–¹å‘¼å·');
                return;
            }
            
            // åˆ›å»ºæ—¥æœŸæ—¶é—´å¯¹è±¡
            let dateTime;
            if (date && time) {
                dateTime = new Date(`${date}T${time}`);
            } else {
                dateTime = new Date();
            }
            
            const record = {
                id: Date.now().toString(),
                callsign,
                frequency,
                mode,
                date: dateTime.toISOString(),
                rstSent,
                rstRcvd,
                name,
                qth,
                gridsquare,
                comment,
                contest
            };
            
            // æ·»åŠ æ¯”èµ›ç‰¹å®šå­—æ®µ
            if (contest === 'CQWPX') {
                record.serial = serial;
            } else if (contest === 'CQWW') {
                record.cqzone = cqzone;
            } else if (contest === 'WAPC') {
                record.qsosNumber = qsosNumber;
                record.province = province;
            }
            
            // æ£€æŸ¥é‡å¤è®°å½•
            const isDuplicate = checkDuplicateRecord(record);
            
            if (isDuplicate && AppState.currentEditingRecord === null) {
                showConfirmation(getTranslation('duplicateFound'), () => {
                    saveRecordToDB(record);
                });
            } else {
                if (AppState.currentEditingRecord !== null) {
                    showConfirmation(getTranslation('updateConfirm'), () => {
                        saveRecordToDB(record);
                    });
                } else {
                    saveRecordToDB(record);
                }
            }
        }

        // æ£€æŸ¥é‡å¤è®°å½•
        function checkDuplicateRecord(record) {
            return AppState.records.some(existingRecord => 
                existingRecord.callsign === record.callsign &&
                existingRecord.frequency === record.frequency &&
                existingRecord.mode === record.mode &&
                Math.abs(new Date(existingRecord.date) - new Date(record.date)) < 60000 // 1åˆ†é’Ÿå†…
            );
        }

        // ä¿å­˜è®°å½•åˆ°æ•°æ®åº“
        function saveRecordToDB(record) {
            if (AppState.currentEditingRecord !== null) {
                // æ›´æ–°ç°æœ‰è®°å½•
                AppState.records[AppState.currentEditingRecord] = record;
                AppState.currentEditingRecord = null;
            } else {
                // æ·»åŠ æ–°è®°å½•
                AppState.records.push(record);
            }
            
            saveData();
            clearForm();
            switchPage('recordsPage');
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector('.nav-tab[data-page="recordsPage"]').classList.add('active');
        }

        // ç¼–è¾‘è®°å½•
        function editRecord(index) {
            const record = AppState.records[index];
            AppState.currentEditingRecord = index;
            
            // å¡«å……è¡¨å•
            document.getElementById('callsign').value = record.callsign;
            document.getElementById('frequency').value = record.frequency;
            
            // è®¾ç½®æ¨¡å¼é€‰æ‹©
            const modeSelect = document.getElementById('modeSelect');
            const modeValue = modeSelect.querySelector('span:first-child');
            modeValue.textContent = record.mode;
            modeValue.setAttribute('data-value', record.mode);
            
            // è®¾ç½®æ¯”èµ›é€‰æ‹©
            const contestSelect = document.getElementById('contestSelect');
            const contestValue = contestSelect.querySelector('span:first-child');
            contestValue.textContent = record.contest || getTranslation('noContest');
            contestValue.setAttribute('data-value', record.contest || '');
            
            const dateObj = new Date(record.date);
            document.getElementById('date').value = dateObj.toISOString().split('T')[0];
            document.getElementById('time').value = 
                `${dateObj.getHours().toString().padStart(2, '0')}:${dateObj.getMinutes().toString().padStart(2, '0')}`;
            
            document.getElementById('rstSent').value = record.rstSent;
            document.getElementById('rstRcvd').value = record.rstRcvd;
            document.getElementById('name').value = record.name || '';
            document.getElementById('qth').value = record.qth || '';
            document.getElementById('gridsquare').value = record.gridsquare || '';
            document.getElementById('comment').value = record.comment || '';
            
            // å¡«å……æ¯”èµ›ç‰¹å®šå­—æ®µ
            document.getElementById('serial').value = record.serial || '';
            document.getElementById('cqzone').value = record.cqzone || '';
            document.getElementById('qsosNumber').value = record.qsosNumber || '';
            document.getElementById('province').value = record.province || '';
            
            // æ›´æ–°æ¯”èµ›ç‰¹å®šå­—æ®µæ˜¾ç¤º
            updateContestFields();
            
            // åˆ‡æ¢åˆ°æ–°å¢é¡µé¢
            switchPage('addPage');
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector('.nav-tab[data-page="addPage"]').classList.add('active');
            
            // æ›´æ–°æŒ‰é’®æ–‡æœ¬
            document.getElementById('saveRecordBtn').textContent = getTranslation('updateRecord');
        }

        // åˆ é™¤è®°å½•
        function deleteRecord(index) {
            AppState.records.splice(index, 1);
            saveData();
            renderRecords();
        }

        // æ¸…ç©ºè¡¨å•
        function clearForm() {
            document.getElementById('callsign').value = '';
            document.getElementById('frequency').value = '';
            
            // é‡ç½®æ¨¡å¼é€‰æ‹©
            const modeSelect = document.getElementById('modeSelect');
            const modeValue = modeSelect.querySelector('span:first-child');
            modeValue.textContent = 'SSB';
            modeValue.setAttribute('data-value', 'SSB');
            
            // é‡ç½®æ¯”èµ›é€‰æ‹©
            const contestSelect = document.getElementById('contestSelect');
            const contestValue = contestSelect.querySelector('span:first-child');
            contestValue.textContent = getTranslation('noContest');
            contestValue.setAttribute('data-value', '');
            
            document.getElementById('date').value = '';
            document.getElementById('time').value = '';
            document.getElementById('rstSent').value = '';
            document.getElementById('rstRcvd').value = '';
            document.getElementById('name').value = '';
            document.getElementById('qth').value = '';
            document.getElementById('gridsquare').value = '';
            document.getElementById('comment').value = '';
            
            // æ¸…ç©ºæ¯”èµ›ç‰¹å®šå­—æ®µ
            document.getElementById('serial').value = '';
            document.getElementById('cqzone').value = '';
            document.getElementById('qsosNumber').value = '';
            document.getElementById('province').value = '';
            
            // éšè—æ¯”èµ›ç‰¹å®šå­—æ®µ
            document.getElementById('contestFields').style.display = 'none';
            
            document.getElementById('saveRecordBtn').textContent = getTranslation('saveRecord');
            AppState.currentEditingRecord = null;
        }

        // ä¿å­˜è®¾ç½®
        function saveSettings() {
            AppState.settings.myCallsign = document.getElementById('myCallsign').value;
            AppState.settings.myGrid = document.getElementById('myGrid').value;
            AppState.settings.myCQZone = document.getElementById('myCQZone').value;
            AppState.settings.myITUZone = document.getElementById('myITUZone').value;
            AppState.settings.myEquipment = document.getElementById('myEquipment').value;
            AppState.settings.myAntenna = document.getElementById('myAntenna').value;
            
            saveData();
            
            // æ›´æ–°é¡¶éƒ¨æ å‘¼å·æ˜¾ç¤º
            document.getElementById('userCallsign').textContent = 
                AppState.settings.myCallsign || getTranslation('noCallsign');
        }

        // åº”ç”¨ç­›é€‰
        function applyFilters() {
            AppState.filters.dateFrom = document.getElementById('filterDateFrom').value;
            AppState.filters.dateTo = document.getElementById('filterDateTo').value;
            AppState.filters.callsign = document.getElementById('filterCallsign').value;
            AppState.filters.grid = document.getElementById('filterGrid').value;
            AppState.filters.contest = document.getElementById('filterContestSelect').querySelector('span:first-child').getAttribute('data-value');
            
            renderRecords();
        }

        // æ¸…é™¤ç­›é€‰
        function clearFilters() {
            document.getElementById('filterDateFrom').value = '';
            document.getElementById('filterDateTo').value = '';
            document.getElementById('filterCallsign').value = '';
            document.getElementById('filterGrid').value = '';
            
            const filterContestSelect = document.getElementById('filterContestSelect');
            const filterContestValue = filterContestSelect.querySelector('span:first-child');
            filterContestValue.textContent = getTranslation('all');
            filterContestValue.setAttribute('data-value', '');
            
            AppState.filters.dateFrom = null;
            AppState.filters.dateTo = null;
            AppState.filters.callsign = '';
            AppState.filters.grid = '';
            AppState.filters.contest = '';
            
            renderRecords();
        }

        // å¤„ç†æ–‡ä»¶å¯¼å…¥
        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                let importedRecords = [];
                
                // å°è¯•è§£æADIæ ¼å¼
                if (file.name.toLowerCase().endsWith('.adi')) {
                    importedRecords = parseADIFile(content);
                } 
                // å°è¯•è§£æCabrilloæ ¼å¼
                else if (file.name.toLowerCase().endsWith('.log') || 
                         file.name.toLowerCase().endsWith('.cabrillo') ||
                         file.name.toLowerCase().endsWith('.txt')) {
                    importedRecords = parseCabrilloFile(content);
                }
                
                if (importedRecords.length > 0) {
                    // ä¸ºæ¯æ¡è®°å½•æ·»åŠ å”¯ä¸€ID
                    importedRecords.forEach(record => {
                        record.id = Date.now().toString() + Math.random().toString(36).substr(2, 9);
                    });
                    
                    // æ£€æŸ¥é‡å¤è®°å½•
                    let duplicates = 0;
                    const uniqueRecords = importedRecords.filter(record => {
                        const isDuplicate = checkDuplicateRecord(record);
                        if (isDuplicate) duplicates++;
                        return !isDuplicate;
                    });
                    
                    // åˆå¹¶è®°å½•
                    AppState.records = [...AppState.records, ...uniqueRecords];
                    saveData();
                    renderRecords();
                    
                    if (duplicates > 0) {
                        showMessage(getTranslation('importPartial', {count: uniqueRecords.length, skipped: duplicates}));
                    } else {
                        showMessage(getTranslation('importSuccess', {count: importedRecords.length}));
                    }
                } else {
                    showMessage(getTranslation('importFailed'));
                }
                
                // é‡ç½®æ–‡ä»¶è¾“å…¥
                event.target.value = '';
            };
            reader.readAsText(file);
        }

        // è§£æADIæ–‡ä»¶
        function parseADIFile(content) {
            const records = [];
            const lines = content.split('\n');
            let currentRecord = {};
            
            for (const line of lines) {
                if (line.trim() === '') continue;
                
                // åŒ¹é…ADIFå­—æ®µ: <FIELD_NAME:length>data
                const fieldMatch = line.match(/<([^:>]+):(\d+)>([^<]*)/);
                if (fieldMatch) {
                    const [, field, length, data] = fieldMatch;
                    currentRecord[field.toLowerCase()] = data.trim();
                }
                
                // é‡åˆ°EORæ ‡è®°ï¼Œä¿å­˜è®°å½•
                if (line.includes('<EOR>')) {
                    if (currentRecord.call) {
                        records.push({
                            callsign: currentRecord.call,
                            frequency: currentRecord.freq || '',
                            mode: currentRecord.mode || '',
                            date: parseADIDate(currentRecord.qso_date, currentRecord.time_on),
                            rstSent: currentRecord.rst_sent || '',
                            rstRcvd: currentRecord.rst_rcvd || '',
                            name: currentRecord.name || '',
                            qth: currentRecord.qth || '',
                            gridsquare: currentRecord.gridsquare || '',
                            comment: currentRecord.comment || '',
                            contest: currentRecord.contest || '',
                            serial: currentRecord.serial || '',
                            cqzone: currentRecord.cqzone || '',
                            qsosNumber: currentRecord.qsos_number || '',
                            province: currentRecord.province || ''
                        });
                    }
                    currentRecord = {};
                }
            }
            
            return records;
        }

        // è§£æADIæ—¥æœŸæ—¶é—´
        function parseADIDate(dateStr, timeStr) {
            if (!dateStr || !timeStr) return new Date().toISOString();
            
            // ADIæ ¼å¼: YYYYMMDD å’Œ HHMMSS
            const year = dateStr.substring(0, 4);
            const month = dateStr.substring(4, 6);
            const day = dateStr.substring(6, 8);
            
            const hour = timeStr.substring(0, 2);
            const minute = timeStr.substring(2, 4);
            const second = timeStr.substring(4, 6) || '00';
            
            return new Date(`${year}-${month}-${day}T${hour}:${minute}:${second}`).toISOString();
        }

        // è§£æCabrilloæ–‡ä»¶
        function parseCabrilloFile(content) {
            const records = [];
            const lines = content.split('\n');
            let contest = '';
            
            // ä»æ–‡ä»¶å¤´è·å–æ¯”èµ›ä¿¡æ¯
            for (const line of lines) {
                if (line.startsWith('CONTEST:')) {
                    contest = line.substring(8).trim();
                    break;
                }
            }
            
            for (const line of lines) {
                if (line.startsWith('QSO:')) {
                    const parts = line.split(/\s+/);
                    // Cabrilloæ ¼å¼å› æ¯”èµ›è€Œå¼‚ï¼Œè¿™é‡Œå®ç°ä¸€ä¸ªé€šç”¨è§£æ
                    if (parts.length >= 8) {
                        // å‡è®¾æ ¼å¼: QSO: freq mode date time sentCall sentRst sentExchange rcvdCall rcvdRst rcvdExchange
                        const freq = parts[1];
                        const mode = parts[2];
                        const date = parts[3];
                        const time = parts[4];
                        const sentCall = parts[5];
                        const sentRst = parts[6];
                        const rcvdCall = parts[7];
                        const rcvdRst = parts[8];
                        
                        records.push({
                            callsign: rcvdCall,
                            frequency: freq,
                            mode: mode,
                            date: parseCabrilloDate(date, time),
                            rstSent: sentRst,
                            rstRcvd: rcvdRst,
                            name: '',
                            qth: '',
                            gridsquare: '',
                            comment: 'ä»Cabrilloæ–‡ä»¶å¯¼å…¥',
                            contest: contest
                        });
                    }
                }
            }
            
            return records;
        }

        // è§£æCabrilloæ—¥æœŸæ—¶é—´
        function parseCabrilloDate(dateStr, timeStr) {
            // Cabrilloæ ¼å¼: YYYY-MM-DD å’Œ HHMM
            return new Date(`${dateStr}T${timeStr.substring(0, 2)}:${timeStr.substring(2, 4)}:00`).toISOString();
        }

        // ç”Ÿæˆå¯¼å‡ºå†…å®¹
        function generateExport() {
            const format = document.querySelector('.theme-option[data-format].active').dataset.format;
            const dateFrom = document.getElementById('exportDateFrom').value;
            const dateTo = document.getElementById('exportDateTo').value;
            const contest = document.getElementById('exportContestSelect').querySelector('span:first-child').getAttribute('data-value');
            let exportContent = '';
            
            // ç­›é€‰è¦å¯¼å‡ºçš„è®°å½•
            let recordsToExport = [...AppState.records];
            
            if (dateFrom) {
                recordsToExport = recordsToExport.filter(record => {
                    const recordDate = new Date(record.date);
                    return recordDate >= new Date(dateFrom);
                });
            }
            
            if (dateTo) {
                recordsToExport = recordsToExport.filter(record => {
                    const recordDate = new Date(record.date);
                    const filterDate = new Date(dateTo);
                    filterDate.setDate(filterDate.getDate() + 1); // åŒ…å«ç»“æŸæ—¥æœŸå½“å¤©
                    return recordDate < filterDate;
                });
            }
            
            // å¦‚æœé€‰æ‹©äº†æ¯”èµ›ï¼Œåªå¯¼å‡ºè¯¥æ¯”èµ›çš„è®°å½•
            if (contest) {
                recordsToExport = recordsToExport.filter(record => record.contest === contest);
            }
            
            if (format === 'adi') {
                exportContent = generateADIContent(recordsToExport);
            } else {
                exportContent = generateCabrilloContent(recordsToExport, contest);
            }
            
            document.getElementById('exportContent').value = exportContent;
            document.getElementById('exportResult').style.display = 'block';
        }

        // ç”ŸæˆADIæ ¼å¼å†…å®¹
        function generateADIContent(records) {
            let content = 'ELVES Log Export\n';
            content += '<ADIF_VER:5>3.1.0\n';
            content += '<CREATED_TIMESTAMP:15>' + new Date().toISOString().replace(/[-:]/g, '').substring(0, 15) + '\n';
            content += '<PROGRAMID:5>ELVES\n';
            content += '<PROGRAMVERSION:13>1.10.20251013\n';
            content += '<EOH>\n';
            
            records.forEach(record => {
                const date = new Date(record.date);
                const dateStr = date.toISOString().substring(0, 10).replace(/-/g, '');
                const timeStr = date.toISOString().substring(11, 19).replace(/:/g, '');
                
                content += `<CALL:${record.callsign.length}>${record.callsign}\n`;
                content += `<BAND:${getBandFromFreq(record.frequency).length}>${getBandFromFreq(record.frequency)}\n`;
                content += `<FREQ:${record.frequency.length}>${record.frequency}\n`;
                content += `<MODE:${record.mode.length}>${record.mode}\n`;
                content += `<QSO_DATE:8>${dateStr}\n`;
                content += `<TIME_ON:6>${timeStr}\n`;
                content += `<RST_SENT:${record.rstSent.length}>${record.rstSent}\n`;
                content += `<RST_RCVD:${record.rstRcvd.length}>${record.rstRcvd}\n`;
                
                if (record.name) {
                    content += `<NAME:${record.name.length}>${record.name}\n`;
                }
                
                if (record.qth) {
                    content += `<QTH:${record.qth.length}>${record.qth}\n`;
                }
                
                if (record.gridsquare) {
                    content += `<GRIDSQUARE:${record.gridsquare.length}>${record.gridsquare}\n`;
                }
                
                if (record.comment) {
                    content += `<COMMENT:${record.comment.length}>${record.comment}\n`;
                }
                
                if (record.contest) {
                    content += `<CONTEST_ID:${record.contest.length}>${record.contest}\n`;
                }
                
                if (record.serial) {
                    content += `<SERIAL:${record.serial.length}>${record.serial}\n`;
                }
                
                if (record.cqzone) {
                    content += `<CQZ:${record.cqzone.length}>${record.cqzone}\n`;
                }
                
                if (record.qsosNumber) {
                    content += `<QSO_NUMBER:${record.qsosNumber.length}>${record.qsosNumber}\n`;
                }
                
                if (record.province) {
                    content += `<STATE:${record.province.length}>${record.province}\n`;
                }
                
                content += '<EOR>\n';
            });
            
            return content;
        }

        // ç”ŸæˆCabrilloæ ¼å¼å†…å®¹
        function generateCabrilloContent(records, contest) {
            let content = 'START-OF-LOG: 3.0\n';
            content += `CREATED-BY: ELVES 1.10.20251013\n`;
            content += `CALLSIGN: ${AppState.settings.myCallsign || 'N0CALL'}\n`;
            content += `CONTEST: ${contest || 'GENERAL'}\n`;
            content += `CATEGORY-OPERATOR: SINGLE-OP\n`;
            content += `CATEGORY-ASSISTED: NON-ASSISTED\n`;
            content += `CATEGORY-BAND: ALL\n`;
            content += `CATEGORY-POWER: HIGH\n`;
            content += `CATEGORY-MODE: MIXED\n`;
            content += `CATEGORY-TRANSMITTER: ONE\n`;
            content += `CLAIMED-SCORE: 0\n`;
            content += `OPERATORS: ${AppState.settings.myCallsign || 'N0CALL'}\n`;
            content += `NAME: ${AppState.settings.myCallsign || 'Operator'}\n`;
            content += `ADDRESS: \n`;
            content += `ADDRESS: \n`;
            content += `ADDRESS: \n`;
            content += `EMAIL: \n`;
            
            records.forEach(record => {
                const date = new Date(record.date);
                const dateStr = date.toISOString().substring(0, 10);
                const timeStr = date.toISOString().substring(11, 16).replace(':', '');
                
                // æ ¹æ®æ¯”èµ›ç±»å‹æ„å»ºäº¤æ¢ä¿¡æ¯
                let sentExchange = '';
                let rcvdExchange = '';
                
                if (contest === 'CQWPX') {
                    sentExchange = record.serial || '001';
                    rcvdExchange = record.serial || '001';
                } else if (contest === 'CQWW') {
                    sentExchange = AppState.settings.myCQZone || '24';
                    rcvdExchange = record.cqzone || '24';
                } else if (contest === 'WAPC') {
                    sentExchange = `${AppState.settings.myCQZone || '24'} ${AppState.settings.myITUZone || '44'}`;
                    rcvdExchange = `${record.cqzone || '24'} ${record.province || 'ZJ'}`;
                } else {
                    sentExchange = record.rstSent;
                    rcvdExchange = record.rstRcvd;
                }
                
                content += `QSO: ${record.frequency} ${record.mode} ${dateStr} ${timeStr} ${AppState.settings.myCallsign || 'N0CALL'} ${record.rstSent} ${sentExchange} ${record.callsign} ${record.rstRcvd} ${rcvdExchange}\n`;
            });
            
            content += 'END-OF-LOG:\n';
            
            return content;
        }

        // æ ¹æ®é¢‘ç‡è·å–æ³¢æ®µ
        function getBandFromFreq(freq) {
            const frequency = parseFloat(freq);
            if (frequency >= 1.8 && frequency <= 2.0) return '160m';
            if (frequency >= 3.5 && frequency <= 4.0) return '80m';
            if (frequency >= 7.0 && frequency <= 7.3) return '40m';
            if (frequency >= 10.1 && frequency <= 10.15) return '30m';
            if (frequency >= 14.0 && frequency <= 14.35) return '20m';
            if (frequency >= 18.068 && frequency <= 18.168) return '17m';
            if (frequency >= 21.0 && frequency <= 21.45) return '15m';
            if (frequency >= 24.89 && frequency <= 24.99) return '12m';
            if (frequency >= 28.0 && frequency <= 29.7) return '10m';
            if (frequency >= 50.0 && frequency <= 54.0) return '6m';
            if (frequency >= 144.0 && frequency <= 148.0) return '2m';
            if (frequency >= 430.0 && frequency <= 440.0) return '70cm';
            return 'Unknown';
        }

        // ä¸‹è½½å¯¼å‡ºæ–‡ä»¶
        function downloadExport() {
            const content = document.getElementById('exportContent').value;
            const format = document.querySelector('.theme-option[data-format].active').dataset.format;
            const filename = document.getElementById('exportFilename').value || 'ham_radio_log';
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${filename}.${format === 'adi' ? 'adi' : 'log'}`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
        function showConfirmation(message, callback) {
            document.getElementById('modalMessage').textContent = message;
            AppState.modalCallback = callback;
            document.getElementById('confirmationModal').classList.add('active');
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(message) {
            document.getElementById('modalMessage').textContent = message;
            AppState.modalCallback = null;
            document.getElementById('modalConfirm').style.display = 'none';
            document.getElementById('confirmationModal').classList.add('active');
            
            // 3ç§’åè‡ªåŠ¨å…³é—­
            setTimeout(() => {
                closeModal();
            }, 3000);
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            document.getElementById('confirmationModal').classList.remove('active');
            document.getElementById('modalConfirm').style.display = 'block';
            AppState.modalCallback = null;
        }
    </script>
</body>
</html>
